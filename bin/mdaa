#!/bin/bash
cwd=`pwd`
parent_path=$( cd "$(dirname "${BASH_SOURCE[0]}")" ; pwd -P )
cd "$parent_path/../"
echo ""
echo "Running NPM Install for MDAA Repo"
npm install --no-save --quiet > /dev/null
echo ""
echo "Building MDAA CLI"
echo ""
npx lerna run build --scope "@aws-mdaa/cli" --loglevel warn > /dev/null

echo ""
echo "Checking for pip availability..."
which pip
if [[ $? -eq 0 ]]; then
    echo "Installing Python Packages with Pip"
    pip install -q -r requirements.txt
else
    echo "Pip not found. Skipping Python package installation. Terraform functionality might be limited."
fi

echo ""
cd "$cwd"
"$parent_path/../packages/cli/bin/mdaa" $@
